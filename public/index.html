<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fast Mini Chat</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loginBox">
  <h2>Fast Mini Chat</h2>

  <input id="username" placeholder="Nome">
  <input id="password" type="password" placeholder="Senha">

  <br>
  <button onclick="register()">Criar conta</button>
  <button onclick="login()">Entrar</button>

  <p id="status"></p>
</div>

<div id="chatBox" style="display:none;">
  <h3>Seu ID: <span id="myId"></span></h3>

  <input id="targetId" placeholder="ID do amigo">

  <div id="messages"></div>

  <input id="messageInput" placeholder="Mensagem">
  <button onclick="sendMessage()">Enviar</button>
</div>

<script>
let ws = new WebSocket(location.origin.replace("http","ws"));
let myId = null;

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);

  if (msg.type === "register-success") {
    status.innerText = "Conta criada! Seu ID: " + msg.id;
  }

  if (msg.type === "register-error") {
    status.innerText = "Nome já existe!";
  }

  if (msg.type === "login-success") {
    myId = msg.id;
    loginBox.style.display = "none";
    chatBox.style.display = "block";
    myIdSpan.innerText = myId;
  }

  if (msg.type === "login-error") {
    status.innerText = "Login inválido!";
  }

  if (msg.type === "private-message") {
    messages.innerHTML += `<p><b>${msg.from}:</b> ${msg.text}</p>`;
  }
};

function register(){
  ws.send(JSON.stringify({
    type:"register",
    username: username.value,
    password: password.value
  }));
}

function login(){
  ws.send(JSON.stringify({
    type:"login",
    username: username.value,
    password: password.value
  }));
}

function sendMessage(){
  ws.send(JSON.stringify({
    type:"private-message",
    to: targetId.value,
    text: messageInput.value
  }));
  messageInput.value = "";
}
</script>

</body>
</html>
